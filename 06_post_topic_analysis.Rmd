---
title: "06_post_topic_analysis"
output: html_notebook
---

```{r}

pronoun_use_post <- pronoun_use_by_donald_posts %>%
  mutate(id = str_sub(link_id,start = -6)) %>%
  left_join(filter(posts_in_donald, num_comments > 9),by = c("id" = "id")) %>%
  transmute(
            num_comments=num_comments.x,
            collective=collective,
            individual=individual,
            contains_we = contains_we,
            title=title,
            selftext=selftext,
            domain=domain,
            selfpost=ifelse(is.na(selftext),"Not Self Post", "Self Post"),
            score=score,
            created_utc = created_utc,
            date = as.POSIXct(created_utc,tz="", origin="1970-01-01")
            ) %>% filter(#!is.na(collective),
                         num_comments > 10)

colSums(is.na(pronoun_use_post))

```


Most and least collective posts
```{r}
pronoun_use_post %>%
  filter(num_comments > 500) %>%
  arrange((collective)) #%>% head(100)
```

```{r}
pronoun_use_post %>%
  filter(num_comments > 100) %>%
  ggplot()+
  geom_density(aes(collective))
```
##Particular words in the title of the post
```{r}
pronoun_use_post %>%
  filter(num_comments > 100) %>%
  mutate(contains_word = ifelse(grepl("the_d",tolower(title)),"yes","no")) %>%
mutate(self_post = ifelse(is.na(selftext),"no","yes")) %>%
  group_by(contains_word) %>%
  summarise(
    collective_weighted = sum(num_comments*collective)/sum(num_comments),
    collective =  mean(collective),
    num_posts  = n(),
    total_comments = sum(num_comments)
  )
  #ggplot()+
  #geom_boxplot(aes(contains_word,collective))



```

## Time series analysis

```{r}
library(plotly)

ggplotly(
  ggplot(filter(pronoun_use_post,num_comments >150) ,aes(date,collective,size = num_comments, name = title, color = selfpost))+
  geom_point()
)
```


